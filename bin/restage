#!/bin/bash

# Unstage two "wip --no-verify" commits, keeping the oldest staged and newest unstaged

set -e

# Get the commit messages for HEAD and HEAD~1
msg_newest=$(git log -1 --format=%s HEAD)
msg_oldest=$(git log -1 --format=%s HEAD~1)

expected="wip --no-verify"

if [[ "$msg_newest" != "$expected" ]]; then
    echo "Error: HEAD commit message is not '$expected'"
    echo "Found: '$msg_newest'"
    exit 1
fi

if [[ "$msg_oldest" != "$expected" ]]; then
    echo "Error: HEAD~1 commit message is not '$expected'"
    echo "Found: '$msg_oldest'"
    exit 1
fi

echo "Both commits are '$expected', proceeding with reset..."

# Mixed reset the newest commit (changes become unstaged)
git reset HEAD~1

# Soft reset the older commit (changes stay staged)
git reset --soft HEAD~1

echo "Done! Oldest commit is staged, newest commit is unstaged."
